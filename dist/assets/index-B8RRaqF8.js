var ht=Object.defineProperty;var mt=(t,n,d)=>n in t?ht(t,n,{enumerable:!0,configurable:!0,writable:!0,value:d}):t[n]=d;var A=(t,n,d)=>(mt(t,typeof n!="symbol"?n+"":n,d),d);(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))i(u);new MutationObserver(u=>{for(const e of u)if(e.type==="childList")for(const a of e.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function d(u){const e={};return u.integrity&&(e.integrity=u.integrity),u.referrerPolicy&&(e.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?e.credentials="include":u.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function i(u){if(u.ep)return;u.ep=!0;const e=d(u);fetch(u.href,e)}})();var ue=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function pt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var dt={exports:{}};(function(t){var n=Object.prototype.hasOwnProperty,d="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(d=!1));function u(g,_,h){this.fn=g,this.context=_,this.once=h||!1}function e(g,_,h,C,w){if(typeof h!="function")throw new TypeError("The listener must be a function");var p=new u(h,C||g,w),l=d?d+_:_;return g._events[l]?g._events[l].fn?g._events[l]=[g._events[l],p]:g._events[l].push(p):(g._events[l]=p,g._eventsCount++),g}function a(g,_){--g._eventsCount===0?g._events=new i:delete g._events[_]}function y(){this._events=new i,this._eventsCount=0}y.prototype.eventNames=function(){var _=[],h,C;if(this._eventsCount===0)return _;for(C in h=this._events)n.call(h,C)&&_.push(d?C.slice(1):C);return Object.getOwnPropertySymbols?_.concat(Object.getOwnPropertySymbols(h)):_},y.prototype.listeners=function(_){var h=d?d+_:_,C=this._events[h];if(!C)return[];if(C.fn)return[C.fn];for(var w=0,p=C.length,l=new Array(p);w<p;w++)l[w]=C[w].fn;return l},y.prototype.listenerCount=function(_){var h=d?d+_:_,C=this._events[h];return C?C.fn?1:C.length:0},y.prototype.emit=function(_,h,C,w,p,l){var s=d?d+_:_;if(!this._events[s])return!1;var r=this._events[s],o=arguments.length,f,m;if(r.fn){switch(r.once&&this.removeListener(_,r.fn,void 0,!0),o){case 1:return r.fn.call(r.context),!0;case 2:return r.fn.call(r.context,h),!0;case 3:return r.fn.call(r.context,h,C),!0;case 4:return r.fn.call(r.context,h,C,w),!0;case 5:return r.fn.call(r.context,h,C,w,p),!0;case 6:return r.fn.call(r.context,h,C,w,p,l),!0}for(m=1,f=new Array(o-1);m<o;m++)f[m-1]=arguments[m];r.fn.apply(r.context,f)}else{var v=r.length,S;for(m=0;m<v;m++)switch(r[m].once&&this.removeListener(_,r[m].fn,void 0,!0),o){case 1:r[m].fn.call(r[m].context);break;case 2:r[m].fn.call(r[m].context,h);break;case 3:r[m].fn.call(r[m].context,h,C);break;case 4:r[m].fn.call(r[m].context,h,C,w);break;default:if(!f)for(S=1,f=new Array(o-1);S<o;S++)f[S-1]=arguments[S];r[m].fn.apply(r[m].context,f)}}return!0},y.prototype.on=function(_,h,C){return e(this,_,h,C,!1)},y.prototype.once=function(_,h,C){return e(this,_,h,C,!0)},y.prototype.removeListener=function(_,h,C,w){var p=d?d+_:_;if(!this._events[p])return this;if(!h)return a(this,p),this;var l=this._events[p];if(l.fn)l.fn===h&&(!w||l.once)&&(!C||l.context===C)&&a(this,p);else{for(var s=0,r=[],o=l.length;s<o;s++)(l[s].fn!==h||w&&!l[s].once||C&&l[s].context!==C)&&r.push(l[s]);r.length?this._events[p]=r.length===1?r[0]:r:a(this,p)}return this},y.prototype.removeAllListeners=function(_){var h;return _?(h=d?d+_:_,this._events[h]&&a(this,h)):(this._events=new i,this._eventsCount=0),this},y.prototype.off=y.prototype.removeListener,y.prototype.addListener=y.prototype.on,y.prefixed=d,y.EventEmitter=y,t.exports=y})(dt);var gt=dt.exports;const nt=pt(gt);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var qe=function(t,n){return qe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,i){d.__proto__=i}||function(d,i){for(var u in i)i.hasOwnProperty(u)&&(d[u]=i[u])},qe(t,n)};function ut(t,n){qe(t,n);function d(){this.constructor=t}t.prototype=n===null?Object.create(n):(d.prototype=n.prototype,new d)}function bt(t){var n=typeof Symbol=="function"&&t[Symbol.iterator],d=0;return n?n.call(t):{next:function(){return t&&d>=t.length&&(t=void 0),{value:t&&t[d++],done:!t}}}}function yt(t,n){var d=typeof Symbol=="function"&&t[Symbol.iterator];if(!d)return t;var i=d.call(t),u,e=[],a;try{for(;(n===void 0||n-- >0)&&!(u=i.next()).done;)e.push(u.value)}catch(y){a={error:y}}finally{try{u&&!u.done&&(d=i.return)&&d.call(i)}finally{if(a)throw a.error}}return e}function vt(){for(var t=[],n=0;n<arguments.length;n++)t=t.concat(yt(arguments[n]));return t}var st=function(){function t(n,d){this.target=d,this.type=n}return t}(),_t=function(t){ut(n,t);function n(d,i){var u=t.call(this,"error",i)||this;return u.message=d.message,u.error=d,u}return n}(st),Et=function(t){ut(n,t);function n(d,i,u){d===void 0&&(d=1e3),i===void 0&&(i="");var e=t.call(this,"close",u)||this;return e.wasClean=!0,e.code=d,e.reason=i,e}return n}(st);/*!
 * Reconnecting WebSocket
 * by Pedro Ladaria <pedro.ladaria@gmail.com>
 * https://github.com/pladaria/reconnecting-websocket
 * License MIT
 */var Tt=function(){if(typeof WebSocket<"u")return WebSocket},wt=function(t){return typeof t<"u"&&!!t&&t.CLOSING===2},ce={maxReconnectionDelay:1e4,minReconnectionDelay:1e3+Math.random()*4e3,minUptime:5e3,reconnectionDelayGrowFactor:1.3,connectionTimeout:4e3,maxRetries:1/0,maxEnqueuedMessages:1/0,startClosed:!1,debug:!1},Lt=function(){function t(n,d,i){var u=this;i===void 0&&(i={}),this._listeners={error:[],message:[],open:[],close:[]},this._retryCount=-1,this._shouldReconnect=!0,this._connectLock=!1,this._binaryType="blob",this._closeCalled=!1,this._messageQueue=[],this.onclose=null,this.onerror=null,this.onmessage=null,this.onopen=null,this._handleOpen=function(e){u._debug("open event");var a=u._options.minUptime,y=a===void 0?ce.minUptime:a;clearTimeout(u._connectTimeout),u._uptimeTimeout=setTimeout(function(){return u._acceptOpen()},y),u._ws.binaryType=u._binaryType,u._messageQueue.forEach(function(g){return u._ws.send(g)}),u._messageQueue=[],u.onopen&&u.onopen(e),u._listeners.open.forEach(function(g){return u._callEventListener(e,g)})},this._handleMessage=function(e){u._debug("message event"),u.onmessage&&u.onmessage(e),u._listeners.message.forEach(function(a){return u._callEventListener(e,a)})},this._handleError=function(e){u._debug("error event",e.message),u._disconnect(void 0,e.message==="TIMEOUT"?"timeout":void 0),u.onerror&&u.onerror(e),u._debug("exec error listeners"),u._listeners.error.forEach(function(a){return u._callEventListener(e,a)}),u._connect()},this._handleClose=function(e){u._debug("close event"),u._clearTimeouts(),u._shouldReconnect&&u._connect(),u.onclose&&u.onclose(e),u._listeners.close.forEach(function(a){return u._callEventListener(e,a)})},this._url=n,this._protocols=d,this._options=i,this._options.startClosed&&(this._shouldReconnect=!1),this._connect()}return Object.defineProperty(t,"CONNECTING",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"OPEN",{get:function(){return 1},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CLOSING",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(t,"CLOSED",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CONNECTING",{get:function(){return t.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"OPEN",{get:function(){return t.OPEN},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CLOSING",{get:function(){return t.CLOSING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"CLOSED",{get:function(){return t.CLOSED},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"binaryType",{get:function(){return this._ws?this._ws.binaryType:this._binaryType},set:function(n){this._binaryType=n,this._ws&&(this._ws.binaryType=n)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"retryCount",{get:function(){return Math.max(this._retryCount,0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"bufferedAmount",{get:function(){var n=this._messageQueue.reduce(function(d,i){return typeof i=="string"?d+=i.length:i instanceof Blob?d+=i.size:d+=i.byteLength,d},0);return n+(this._ws?this._ws.bufferedAmount:0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"extensions",{get:function(){return this._ws?this._ws.extensions:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"protocol",{get:function(){return this._ws?this._ws.protocol:""},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"readyState",{get:function(){return this._ws?this._ws.readyState:this._options.startClosed?t.CLOSED:t.CONNECTING},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"url",{get:function(){return this._ws?this._ws.url:""},enumerable:!0,configurable:!0}),t.prototype.close=function(n,d){if(n===void 0&&(n=1e3),this._closeCalled=!0,this._shouldReconnect=!1,this._clearTimeouts(),!this._ws){this._debug("close enqueued: no ws instance");return}if(this._ws.readyState===this.CLOSED){this._debug("close: already closed");return}this._ws.close(n,d)},t.prototype.reconnect=function(n,d){this._shouldReconnect=!0,this._closeCalled=!1,this._retryCount=-1,!this._ws||this._ws.readyState===this.CLOSED?this._connect():(this._disconnect(n,d),this._connect())},t.prototype.send=function(n){if(this._ws&&this._ws.readyState===this.OPEN)this._debug("send",n),this._ws.send(n);else{var d=this._options.maxEnqueuedMessages,i=d===void 0?ce.maxEnqueuedMessages:d;this._messageQueue.length<i&&(this._debug("enqueue",n),this._messageQueue.push(n))}},t.prototype.addEventListener=function(n,d){this._listeners[n]&&this._listeners[n].push(d)},t.prototype.dispatchEvent=function(n){var d,i,u=this._listeners[n.type];if(u)try{for(var e=bt(u),a=e.next();!a.done;a=e.next()){var y=a.value;this._callEventListener(n,y)}}catch(g){d={error:g}}finally{try{a&&!a.done&&(i=e.return)&&i.call(e)}finally{if(d)throw d.error}}return!0},t.prototype.removeEventListener=function(n,d){this._listeners[n]&&(this._listeners[n]=this._listeners[n].filter(function(i){return i!==d}))},t.prototype._debug=function(){for(var n=[],d=0;d<arguments.length;d++)n[d]=arguments[d];this._options.debug&&console.log.apply(console,vt(["RWS>"],n))},t.prototype._getNextDelay=function(){var n=this._options,d=n.reconnectionDelayGrowFactor,i=d===void 0?ce.reconnectionDelayGrowFactor:d,u=n.minReconnectionDelay,e=u===void 0?ce.minReconnectionDelay:u,a=n.maxReconnectionDelay,y=a===void 0?ce.maxReconnectionDelay:a,g=0;return this._retryCount>0&&(g=e*Math.pow(i,this._retryCount-1),g>y&&(g=y)),this._debug("next delay",g),g},t.prototype._wait=function(){var n=this;return new Promise(function(d){setTimeout(d,n._getNextDelay())})},t.prototype._getNextUrl=function(n){if(typeof n=="string")return Promise.resolve(n);if(typeof n=="function"){var d=n();if(typeof d=="string")return Promise.resolve(d);if(d.then)return d}throw Error("Invalid URL")},t.prototype._connect=function(){var n=this;if(!(this._connectLock||!this._shouldReconnect)){this._connectLock=!0;var d=this._options,i=d.maxRetries,u=i===void 0?ce.maxRetries:i,e=d.connectionTimeout,a=e===void 0?ce.connectionTimeout:e,y=d.WebSocket,g=y===void 0?Tt():y;if(this._retryCount>=u){this._debug("max retries reached",this._retryCount,">=",u);return}if(this._retryCount++,this._debug("connect",this._retryCount),this._removeListeners(),!wt(g))throw Error("No valid WebSocket class provided");this._wait().then(function(){return n._getNextUrl(n._url)}).then(function(_){n._closeCalled||(n._debug("connect",{url:_,protocols:n._protocols}),n._ws=n._protocols?new g(_,n._protocols):new g(_),n._ws.binaryType=n._binaryType,n._connectLock=!1,n._addListeners(),n._connectTimeout=setTimeout(function(){return n._handleTimeout()},a))})}},t.prototype._handleTimeout=function(){this._debug("timeout event"),this._handleError(new _t(Error("TIMEOUT"),this))},t.prototype._disconnect=function(n,d){if(n===void 0&&(n=1e3),this._clearTimeouts(),!!this._ws){this._removeListeners();try{this._ws.close(n,d),this._handleClose(new Et(n,d,this))}catch{}}},t.prototype._acceptOpen=function(){this._debug("accept open"),this._retryCount=0},t.prototype._callEventListener=function(n,d){"handleEvent"in d?d.handleEvent(n):d(n)},t.prototype._removeListeners=function(){this._ws&&(this._debug("removeListeners"),this._ws.removeEventListener("open",this._handleOpen),this._ws.removeEventListener("close",this._handleClose),this._ws.removeEventListener("message",this._handleMessage),this._ws.removeEventListener("error",this._handleError))},t.prototype._addListeners=function(){this._ws&&(this._debug("addListeners"),this._ws.addEventListener("open",this._handleOpen),this._ws.addEventListener("close",this._handleClose),this._ws.addEventListener("message",this._handleMessage),this._ws.addEventListener("error",this._handleError))},t.prototype._clearTimeouts=function(){clearTimeout(this._connectTimeout),clearTimeout(this._uptimeTimeout)},t}();const Ct=Lt;function St(t){const n=Object.entries(t).filter(([,d])=>Array.isArray(d)?d.length:d!==void 0).reduce((d,[i,u])=>(d[i]=u,d),{});return Object.entries(n).map(d=>`${d[0]}=${encodeURIComponent(d[1])}`).join("&")}class It extends nt{constructor(d,i,u){super();A(this,"stream");A(this,"state","initializing");A(this,"sharedConnectionPools",[]);A(this,"sharedConnections",[]);A(this,"nonSharedConnections",[]);A(this,"idCounter",0);this.genId=this.genId.bind(this),this.useChannel=this.useChannel.bind(this),this.useSharedConnection=this.useSharedConnection.bind(this),this.removeSharedConnection=this.removeSharedConnection.bind(this),this.removeSharedConnectionPool=this.removeSharedConnectionPool.bind(this),this.connectToChannel=this.connectToChannel.bind(this),this.disconnectToChannel=this.disconnectToChannel.bind(this),this.onOpen=this.onOpen.bind(this),this.onClose=this.onClose.bind(this),this.onMessage=this.onMessage.bind(this),this.send=this.send.bind(this),this.close=this.close.bind(this),u=u??{};const e=St({i:i==null?void 0:i.token,_t:Date.now()}),a=d.replace("http://","ws://").replace("https://","wss://");this.stream=new Ct(`${a}/streaming?${e}`,"",{minReconnectionDelay:1,WebSocket:u.WebSocket}),this.stream.addEventListener("open",this.onOpen),this.stream.addEventListener("close",this.onClose),this.stream.addEventListener("message",this.onMessage)}genId(){return(++this.idCounter).toString()}useChannel(d,i,u){return i?this.connectToChannel(d,i):this.useSharedConnection(d,u)}useSharedConnection(d,i){let u=this.sharedConnectionPools.find(a=>a.channel===d);u==null&&(u=new Ot(this,d,this.genId()),this.sharedConnectionPools.push(u));const e=new $t(this,d,u,i);return this.sharedConnections.push(e),e}removeSharedConnection(d){this.sharedConnections=this.sharedConnections.filter(i=>i!==d)}removeSharedConnectionPool(d){this.sharedConnectionPools=this.sharedConnectionPools.filter(i=>i!==d)}connectToChannel(d,i){const u=new Nt(this,d,this.genId(),i);return this.nonSharedConnections.push(u),u}disconnectToChannel(d){this.nonSharedConnections=this.nonSharedConnections.filter(i=>i!==d)}onOpen(){const d=this.state==="reconnecting";if(this.state="connected",this.emit("_connected_"),d){for(const i of this.sharedConnectionPools)i.connect();for(const i of this.nonSharedConnections)i.connect()}}onClose(){this.state==="connected"&&(this.state="reconnecting",this.emit("_disconnected_"))}onMessage(d){const{type:i,body:u}=JSON.parse(d.data);if(i==="channel"){const e=u.id;let a;if(a=this.sharedConnections.filter(y=>y.id===e),a.length===0){const y=this.nonSharedConnections.find(g=>g.id===e);y&&(a=[y])}for(const y of a)y.emit(u.type,u.body),y.inCount++}else this.emit(i,u)}send(d,i){if(typeof d=="string"){this.stream.send(JSON.stringify({type:d,...i===void 0?{}:{body:i}}));return}this.stream.send(JSON.stringify(d))}ping(){this.stream.send("ping")}heartbeat(){this.stream.send("h")}close(){this.stream.close()}}class Ot{constructor(n,d,i){A(this,"channel");A(this,"id");A(this,"stream");A(this,"users",0);A(this,"disposeTimerId");A(this,"isConnected",!1);this.onStreamDisconnected=this.onStreamDisconnected.bind(this),this.inc=this.inc.bind(this),this.dec=this.dec.bind(this),this.connect=this.connect.bind(this),this.disconnect=this.disconnect.bind(this),this.channel=d,this.stream=n,this.id=i,this.stream.on("_disconnected_",this.onStreamDisconnected)}onStreamDisconnected(){this.isConnected=!1}inc(){this.users===0&&!this.isConnected&&this.connect(),this.users++,this.disposeTimerId&&(clearTimeout(this.disposeTimerId),this.disposeTimerId=null)}dec(){this.users--,this.users===0&&(this.disposeTimerId=setTimeout(()=>{this.disconnect()},3e3))}connect(){this.isConnected||(this.isConnected=!0,this.stream.send("connect",{channel:this.channel,id:this.id}))}disconnect(){this.stream.off("_disconnected_",this.onStreamDisconnected),this.stream.send("disconnect",{id:this.id}),this.stream.removeSharedConnectionPool(this)}}class rt extends nt{constructor(d,i,u){super();A(this,"channel");A(this,"stream");A(this,"name");A(this,"inCount",0);A(this,"outCount",0);this.send=this.send.bind(this),this.stream=d,this.channel=i,this.name=u}send(d,i){this.stream.send("ch",{id:this.id,type:d,body:i}),this.outCount++}}class $t extends rt{constructor(d,i,u,e){super(d,i,e);A(this,"pool");this.dispose=this.dispose.bind(this),this.pool=u,this.pool.inc()}get id(){return this.pool.id}dispose(){this.pool.dec(),this.removeAllListeners(),this.stream.removeSharedConnection(this)}}class Nt extends rt{constructor(d,i,u,e){super(d,i);A(this,"id");A(this,"params");this.connect=this.connect.bind(this),this.dispose=this.dispose.bind(this),this.params=e,this.id=u,this.connect()}connect(){this.stream.send("connect",{channel:this.channel,id:this.id,params:this.params})}dispose(){this.removeAllListeners(),this.stream.send("disconnect",{id:this.id}),this.stream.disconnectToChannel(this)}}const Mt=Symbol();class Re{constructor(n){A(this,"origin");A(this,"credential");A(this,"fetch");this.origin=n.origin,this.credential=n.credential,this.fetch=n.fetch??((...d)=>fetch(...d))}request(n,d={},i){return new Promise((u,e)=>{this.fetch(`${this.origin}/api/${n}`,{method:"POST",body:JSON.stringify({...d,i:i!==void 0?i:this.credential}),headers:{"Content-Type":"application/json"},credentials:"omit",cache:"no-cache"}).then(async a=>{const y=a.status===204?null:await a.json();a.status===200||a.status===204?u(y):e({[Mt]:!0,...y.error})}).catch(e)})}}var ke={},G={},oe={},ve={},it={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.createLanguage=t.lazy=t.lineEnd=t.lineBegin=t.char=t.newline=t.crlf=t.lf=t.cr=t.notMatch=t.alt=t.seq=t.regexp=t.str=t.Parser=t.failure=t.success=void 0;function n(w,p){return{success:!0,value:p,index:w}}t.success=n;function d(){return{success:!1}}t.failure=d;class i{constructor(p,l){this.handler=(s,r,o)=>{if(o.trace&&this.name!=null){const f=`${r}`;console.log(`${f.padEnd(6," ")}enter ${this.name}`);const m=p(s,r,o);if(m.success){const v=`${r}:${m.index}`;console.log(`${v.padEnd(6," ")}match ${this.name}`)}else{const v=`${r}`;console.log(`${v.padEnd(6," ")}fail ${this.name}`)}return m}return p(s,r,o)},this.name=l}map(p){return new i((l,s,r)=>{const o=this.handler(l,s,r);return o.success?n(o.index,p(o.value)):o})}text(){return new i((p,l,s)=>{const r=this.handler(p,l,s);if(!r.success)return r;const o=p.slice(l,r.index);return n(r.index,o)})}many(p){return new i((l,s,r)=>{let o,f=s;const m=[];for(;f<l.length&&(o=this.handler(l,f,r),!!o.success);)f=o.index,m.push(o.value);return m.length<p?d():n(f,m)})}sep(p,l){if(l<1)throw new Error('"min" must be a value greater than or equal to 1.');return a([this,a([p,this],1).many(l-1)]).map(s=>[s[0],...s[1]])}option(){return y([this,g(null)])}}t.Parser=i;function u(w){return new i((p,l,s)=>p.length-l<w.length||p.substr(l,w.length)!==w?d():n(l+w.length,w))}t.str=u;function e(w){const p=RegExp(`^(?:${w.source})`,w.flags);return new i((l,s,r)=>{const o=l.slice(s),f=p.exec(o);return f==null?d():n(s+f[0].length,f[0])})}t.regexp=e;function a(w,p){return new i((l,s,r)=>{let o,f=s;const m=[];for(let v=0;v<w.length;v++){if(o=w[v].handler(l,f,r),!o.success)return o;f=o.index,m.push(o.value)}return n(f,p!=null?m[p]:m)})}t.seq=a;function y(w){return new i((p,l,s)=>{let r;for(let o=0;o<w.length;o++)if(r=w[o].handler(p,l,s),r.success)return r;return d()})}t.alt=y;function g(w){return new i((p,l,s)=>n(l,w))}function _(w){return new i((p,l,s)=>w.handler(p,l,s).success?d():n(l,null))}t.notMatch=_,t.cr=u("\r"),t.lf=u(`
`),t.crlf=u(`\r
`),t.newline=y([t.crlf,t.cr,t.lf]),t.char=new i((w,p,l)=>{if(w.length-p<1)return d();const s=w.charAt(p);return n(p+1,s)}),t.lineBegin=new i((w,p,l)=>p===0||t.cr.handler(w,p-1,l).success||t.lf.handler(w,p-1,l).success?n(p,null):d()),t.lineEnd=new i((w,p,l)=>p===w.length||t.cr.handler(w,p,l).success||t.lf.handler(w,p,l).success?n(p,null):d());function h(w){const p=new i((l,s,r)=>(p.handler=w().handler,p.handler(l,s,r)));return p}t.lazy=h;function C(w){const p={};for(const l of Object.keys(w))p[l]=h(()=>{const s=w[l](p);if(s==null)throw new Error("syntax must return a parser.");return s.name=l,s});return p}t.createLanguage=C})(it);var X={},De={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.TEXT=t.PLAIN=t.FN=t.LINK=t.N_URL=t.HASHTAG=t.MENTION=t.MATH_INLINE=t.INLINE_CODE=t.STRIKE=t.ITALIC=t.SMALL=t.BOLD=t.EMOJI_CODE=t.UNI_EMOJI=t.CENTER=t.MATH_BLOCK=t.CODE_BLOCK=t.SEARCH=t.QUOTE=t.isMfmBlock=void 0;const n=["quote","search","blockCode","mathBlock","center"];function d(E){return n.includes(E.type)}t.isMfmBlock=d;const i=E=>({type:"quote",children:E});t.QUOTE=i;const u=(E,j)=>({type:"search",props:{query:E,content:j}});t.SEARCH=u;const e=(E,j)=>({type:"blockCode",props:{code:E,lang:j}});t.CODE_BLOCK=e;const a=E=>({type:"mathBlock",props:{formula:E}});t.MATH_BLOCK=a;const y=E=>({type:"center",children:E});t.CENTER=y;const g=E=>({type:"unicodeEmoji",props:{emoji:E}});t.UNI_EMOJI=g;const _=E=>({type:"emojiCode",props:{name:E}});t.EMOJI_CODE=_;const h=E=>({type:"bold",children:E});t.BOLD=h;const C=E=>({type:"small",children:E});t.SMALL=C;const w=E=>({type:"italic",children:E});t.ITALIC=w;const p=E=>({type:"strike",children:E});t.STRIKE=p;const l=E=>({type:"inlineCode",props:{code:E}});t.INLINE_CODE=l;const s=E=>({type:"mathInline",props:{formula:E}});t.MATH_INLINE=s;const r=(E,j,B)=>({type:"mention",props:{username:E,host:j,acct:B}});t.MENTION=r;const o=E=>({type:"hashtag",props:{hashtag:E}});t.HASHTAG=o;const f=(E,j)=>{const B={type:"url",props:{url:E}};return j&&(B.props.brackets=j),B};t.N_URL=f;const m=(E,j,B)=>({type:"link",props:{silent:E,url:j},children:B});t.LINK=m;const v=(E,j,B)=>({type:"fn",props:{name:E,args:j},children:B});t.FN=v;const S=E=>({type:"plain",children:[(0,t.TEXT)(E)]});t.PLAIN=S;const O=E=>({type:"text",props:{text:E}});t.TEXT=O})(De);Object.defineProperty(X,"__esModule",{value:!0});X.inspectOne=X.stringifyTree=X.stringifyNode=X.mergeText=void 0;const Be=De;function Pt(t){const n=[],d=[];function i(){d.length>0&&(n.push((0,Be.TEXT)(d.join(""))),d.length=0)}const u=t.flat(1);for(const e of u)typeof e=="string"?d.push(e):!Array.isArray(e)&&e.type==="text"?d.push(e.props.text):(i(),n.push(e));return i(),n}X.mergeText=Pt;function ct(t){var n;switch(t.type){case"quote":return ee(t.children).split(`
`).map(d=>`> ${d}`).join(`
`);case"search":return t.props.content;case"blockCode":return`\`\`\`${(n=t.props.lang)!==null&&n!==void 0?n:""}
${t.props.code}
\`\`\``;case"mathBlock":return`\\[
${t.props.formula}
\\]`;case"center":return`<center>
${ee(t.children)}
</center>`;case"emojiCode":return`:${t.props.name}:`;case"unicodeEmoji":return t.props.emoji;case"bold":return`**${ee(t.children)}**`;case"small":return`<small>${ee(t.children)}</small>`;case"italic":return`<i>${ee(t.children)}</i>`;case"strike":return`~~${ee(t.children)}~~`;case"inlineCode":return`\`${t.props.code}\``;case"mathInline":return`\\(${t.props.formula}\\)`;case"mention":return t.props.acct;case"hashtag":return`#${t.props.hashtag}`;case"url":return t.props.brackets?`<${t.props.url}>`:t.props.url;case"link":return`${t.props.silent?"?":""}[${ee(t.children)}](${t.props.url})`;case"fn":{const d=Object.keys(t.props.args).map(u=>{const e=t.props.args[u];return e===!0?u:`${u}=${e}`}),i=d.length>0?"."+d.join(","):"";return`$[${t.props.name}${i} ${ee(t.children)}]`}case"plain":return`<plain>
${ee(t.children)}
</plain>`;case"text":return t.props.text}throw new Error("unknown mfm node")}X.stringifyNode=ct;var se;(function(t){t[t.none=0]="none",t[t.inline=1]="inline",t[t.block=2]="block"})(se||(se={}));function ee(t){const n=[];let d=se.none;for(const i of t){let u=!0;(0,Be.isMfmBlock)(i)?(d===se.none&&(u=!1),d=se.block):((d===se.none||d===se.inline)&&(u=!1),d=se.inline),u&&n.push((0,Be.TEXT)(`
`)),n.push(i)}return n.map(i=>ct(i)).join("")}X.stringifyTree=ee;function ot(t,n){if(n(t),t.children!=null)for(const d of t.children)ot(d,n)}X.inspectOne=ot;var He={};Object.defineProperty(He,"__esModule",{value:!0});He.default=/(?:\ud83d\udc68\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc68\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc68\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc68\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc68\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc69\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c[\udffc-\udfff]|\ud83e\uddd1\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c[\udffb\udffd-\udfff]|\ud83e\uddd1\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c[\udffb\udffc\udffe\udfff]|\ud83e\uddd1\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c[\udffb-\udffd\udfff]|\ud83e\uddd1\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83e\uddd1\ud83c[\udffb-\udffe]|\ud83d\udc68\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc68\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc68\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc68\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc68\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc68\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc68\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc68\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc68\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc68\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffc-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffd-\udfff]|\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb\udffc\udffe\udfff]|\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffd\udfff]|\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc68\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83d\udc69\ud83c[\udffb-\udfff]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc68\ud83c[\udffb-\udffe]|\ud83d\udc69\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83d\udc69\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udffb\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c[\udffc-\udfff]|\ud83e\uddd1\ud83c\udffb\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffc\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c[\udffb\udffd-\udfff]|\ud83e\uddd1\ud83c\udffc\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffd\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c[\udffb\udffc\udffe\udfff]|\ud83e\uddd1\ud83c\udffd\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udffe\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c[\udffb-\udffd\udfff]|\ud83e\uddd1\ud83c\udffe\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83e\uddd1\ud83c\udfff\u200d\u2764\ufe0f\u200d\ud83e\uddd1\ud83c[\udffb-\udffe]|\ud83e\uddd1\ud83c\udfff\u200d\ud83e\udd1d\u200d\ud83e\uddd1\ud83c[\udffb-\udfff]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d\udc68|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d\udc8b\u200d\ud83d[\udc68\udc69]|\ud83e\udef1\ud83c\udffb\u200d\ud83e\udef2\ud83c[\udffc-\udfff]|\ud83e\udef1\ud83c\udffc\u200d\ud83e\udef2\ud83c[\udffb\udffd-\udfff]|\ud83e\udef1\ud83c\udffd\u200d\ud83e\udef2\ud83c[\udffb\udffc\udffe\udfff]|\ud83e\udef1\ud83c\udffe\u200d\ud83e\udef2\ud83c[\udffb-\udffd\udfff]|\ud83e\udef1\ud83c\udfff\u200d\ud83e\udef2\ud83c[\udffb-\udffe]|\ud83d\udc68\u200d\u2764\ufe0f\u200d\ud83d\udc68|\ud83d\udc69\u200d\u2764\ufe0f\u200d\ud83d[\udc68\udc69]|\ud83e\uddd1\u200d\ud83e\udd1d\u200d\ud83e\uddd1|\ud83d\udc6b\ud83c[\udffb-\udfff]|\ud83d\udc6c\ud83c[\udffb-\udfff]|\ud83d\udc6d\ud83c[\udffb-\udfff]|\ud83d\udc8f\ud83c[\udffb-\udfff]|\ud83d\udc91\ud83c[\udffb-\udfff]|\ud83e\udd1d\ud83c[\udffb-\udfff]|\ud83d[\udc6b-\udc6d\udc8f\udc91]|\ud83e\udd1d)|(?:\ud83d[\udc68\udc69]|\ud83e\uddd1)(?:\ud83c[\udffb-\udfff])?\u200d(?:\u2695\ufe0f|\u2696\ufe0f|\u2708\ufe0f|\ud83c[\udf3e\udf73\udf7c\udf84\udf93\udfa4\udfa8\udfeb\udfed]|\ud83d[\udcbb\udcbc\udd27\udd2c\ude80\ude92]|\ud83e[\uddaf-\uddb3\uddbc\uddbd])|(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75]|\u26f9)((?:\ud83c[\udffb-\udfff]|\ufe0f)\u200d[\u2640\u2642]\ufe0f)|(?:\ud83c[\udfc3\udfc4\udfca]|\ud83d[\udc6e\udc70\udc71\udc73\udc77\udc81\udc82\udc86\udc87\ude45-\ude47\ude4b\ude4d\ude4e\udea3\udeb4-\udeb6]|\ud83e[\udd26\udd35\udd37-\udd39\udd3d\udd3e\uddb8\uddb9\uddcd-\uddcf\uddd4\uddd6-\udddd])(?:\ud83c[\udffb-\udfff])?\u200d[\u2640\u2642]\ufe0f|(?:\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc68\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc68\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc66\u200d\ud83d\udc66|\ud83d\udc69\u200d\ud83d\udc67\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f|\ud83c\udff3\ufe0f\u200d\ud83c\udf08|\ud83d\ude36\u200d\ud83c\udf2b\ufe0f|\u2764\ufe0f\u200d\ud83d\udd25|\u2764\ufe0f\u200d\ud83e\ude79|\ud83c\udff4\u200d\u2620\ufe0f|\ud83d\udc15\u200d\ud83e\uddba|\ud83d\udc3b\u200d\u2744\ufe0f|\ud83d\udc41\u200d\ud83d\udde8|\ud83d\udc68\u200d\ud83d[\udc66\udc67]|\ud83d\udc69\u200d\ud83d[\udc66\udc67]|\ud83d\udc6f\u200d\u2640\ufe0f|\ud83d\udc6f\u200d\u2642\ufe0f|\ud83d\ude2e\u200d\ud83d\udca8|\ud83d\ude35\u200d\ud83d\udcab|\ud83e\udd3c\u200d\u2640\ufe0f|\ud83e\udd3c\u200d\u2642\ufe0f|\ud83e\uddde\u200d\u2640\ufe0f|\ud83e\uddde\u200d\u2642\ufe0f|\ud83e\udddf\u200d\u2640\ufe0f|\ud83e\udddf\u200d\u2642\ufe0f|\ud83d\udc08\u200d\u2b1b|\ud83d\udc26\u200d\u2b1b)|[#*0-9]\ufe0f?\u20e3|(?:[©®\u2122\u265f]\ufe0f)|(?:\ud83c[\udc04\udd70\udd71\udd7e\udd7f\ude02\ude1a\ude2f\ude37\udf21\udf24-\udf2c\udf36\udf7d\udf96\udf97\udf99-\udf9b\udf9e\udf9f\udfcd\udfce\udfd4-\udfdf\udff3\udff5\udff7]|\ud83d[\udc3f\udc41\udcfd\udd49\udd4a\udd6f\udd70\udd73\udd76-\udd79\udd87\udd8a-\udd8d\udda5\udda8\uddb1\uddb2\uddbc\uddc2-\uddc4\uddd1-\uddd3\udddc-\uddde\udde1\udde3\udde8\uddef\uddf3\uddfa\udecb\udecd-\udecf\udee0-\udee5\udee9\udef0\udef3]|[\u203c\u2049\u2139\u2194-\u2199\u21a9\u21aa\u231a\u231b\u2328\u23cf\u23ed-\u23ef\u23f1\u23f2\u23f8-\u23fa\u24c2\u25aa\u25ab\u25b6\u25c0\u25fb-\u25fe\u2600-\u2604\u260e\u2611\u2614\u2615\u2618\u2620\u2622\u2623\u2626\u262a\u262e\u262f\u2638-\u263a\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267b\u267f\u2692-\u2697\u2699\u269b\u269c\u26a0\u26a1\u26a7\u26aa\u26ab\u26b0\u26b1\u26bd\u26be\u26c4\u26c5\u26c8\u26cf\u26d1\u26d3\u26d4\u26e9\u26ea\u26f0-\u26f5\u26f8\u26fa\u26fd\u2702\u2708\u2709\u270f\u2712\u2714\u2716\u271d\u2721\u2733\u2734\u2744\u2747\u2757\u2763\u2764\u27a1\u2934\u2935\u2b05-\u2b07\u2b1b\u2b1c\u2b50\u2b55\u3030\u303d\u3297\u3299])(?:\ufe0f|(?!\ufe0e))|(?:(?:\ud83c[\udfcb\udfcc]|\ud83d[\udd74\udd75\udd90]|\ud83e\udef0|[\u261d\u26f7\u26f9\u270c\u270d])(?:\ufe0f|(?!\ufe0e))|(?:\ud83c[\udf85\udfc2-\udfc4\udfc7\udfca]|\ud83d[\udc42\udc43\udc46-\udc50\udc66-\udc69\udc6e\udc70-\udc78\udc7c\udc81-\udc83\udc85-\udc87\udcaa\udd7a\udd95\udd96\ude45-\ude47\ude4b-\ude4f\udea3\udeb4-\udeb6\udec0\udecc]|\ud83e[\udd0c\udd0f\udd18-\udd1c\udd1e\udd1f\udd26\udd30-\udd39\udd3d\udd3e\udd77\uddb5\uddb6\uddb8\uddb9\uddbb\uddcd-\uddcf\uddd1-\udddd\udec3-\udec5\udef1-\udef8]|[\u270a\u270b]))(?:\ud83c[\udffb-\udfff])?|(?:\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc73\udb40\udc63\udb40\udc74\udb40\udc7f|\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc77\udb40\udc6c\udb40\udc73\udb40\udc7f|\ud83c\udde6\ud83c[\udde8-\uddec\uddee\uddf1\uddf2\uddf4\uddf6-\uddfa\uddfc\uddfd\uddff]|\ud83c\udde7\ud83c[\udde6\udde7\udde9-\uddef\uddf1-\uddf4\uddf6-\uddf9\uddfb\uddfc\uddfe\uddff]|\ud83c\udde8\ud83c[\udde6\udde8\udde9\uddeb-\uddee\uddf0-\uddf5\uddf7\uddfa-\uddff]|\ud83c\udde9\ud83c[\uddea\uddec\uddef\uddf0\uddf2\uddf4\uddff]|\ud83c\uddea\ud83c[\udde6\udde8\uddea\uddec\udded\uddf7-\uddfa]|\ud83c\uddeb\ud83c[\uddee-\uddf0\uddf2\uddf4\uddf7]|\ud83c\uddec\ud83c[\udde6\udde7\udde9-\uddee\uddf1-\uddf3\uddf5-\uddfa\uddfc\uddfe]|\ud83c\udded\ud83c[\uddf0\uddf2\uddf3\uddf7\uddf9\uddfa]|\ud83c\uddee\ud83c[\udde8-\uddea\uddf1-\uddf4\uddf6-\uddf9]|\ud83c\uddef\ud83c[\uddea\uddf2\uddf4\uddf5]|\ud83c\uddf0\ud83c[\uddea\uddec-\uddee\uddf2\uddf3\uddf5\uddf7\uddfc\uddfe\uddff]|\ud83c\uddf1\ud83c[\udde6-\udde8\uddee\uddf0\uddf7-\uddfb\uddfe]|\ud83c\uddf2\ud83c[\udde6\udde8-\udded\uddf0-\uddff]|\ud83c\uddf3\ud83c[\udde6\udde8\uddea-\uddec\uddee\uddf1\uddf4\uddf5\uddf7\uddfa\uddff]|\ud83c\uddf4\ud83c\uddf2|\ud83c\uddf5\ud83c[\udde6\uddea-\udded\uddf0-\uddf3\uddf7-\uddf9\uddfc\uddfe]|\ud83c\uddf6\ud83c\udde6|\ud83c\uddf7\ud83c[\uddea\uddf4\uddf8\uddfa\uddfc]|\ud83c\uddf8\ud83c[\udde6-\uddea\uddec-\uddf4\uddf7-\uddf9\uddfb\uddfd-\uddff]|\ud83c\uddf9\ud83c[\udde6\udde8\udde9\uddeb-\udded\uddef-\uddf4\uddf7\uddf9\uddfb\uddfc\uddff]|\ud83c\uddfa\ud83c[\udde6\uddec\uddf2\uddf3\uddf8\uddfe\uddff]|\ud83c\uddfb\ud83c[\udde6\udde8\uddea\uddec\uddee\uddf3\uddfa]|\ud83c\uddfc\ud83c[\uddeb\uddf8]|\ud83c\uddfd\ud83c\uddf0|\ud83c\uddfe\ud83c[\uddea\uddf9]|\ud83c\uddff\ud83c[\udde6\uddf2\uddfc]|\ud83c[\udccf\udd8e\udd91-\udd9a\udde6-\uddff\ude01\ude32-\ude36\ude38-\ude3a\ude50\ude51\udf00-\udf20\udf2d-\udf35\udf37-\udf7c\udf7e-\udf84\udf86-\udf93\udfa0-\udfc1\udfc5\udfc6\udfc8\udfc9\udfcf-\udfd3\udfe0-\udff0\udff4\udff8-\udfff]|\ud83d[\udc00-\udc3e\udc40\udc44\udc45\udc51-\udc65\udc6a\udc6f\udc79-\udc7b\udc7d-\udc80\udc84\udc88-\udc8e\udc90\udc92-\udca9\udcab-\udcfc\udcff-\udd3d\udd4b-\udd4e\udd50-\udd67\udda4\uddfb-\ude44\ude48-\ude4a\ude80-\udea2\udea4-\udeb3\udeb7-\udebf\udec1-\udec5\uded0-\uded2\uded5-\uded7\udedc-\udedf\udeeb\udeec\udef4-\udefc\udfe0-\udfeb\udff0]|\ud83e[\udd0d\udd0e\udd10-\udd17\udd20-\udd25\udd27-\udd2f\udd3a\udd3c\udd3f-\udd45\udd47-\udd76\udd78-\uddb4\uddb7\uddba\uddbc-\uddcc\uddd0\uddde-\uddff\ude70-\ude7c\ude80-\ude88\ude90-\udebd\udebf-\udec2\udece-\udedb\udee0-\udee8]|[\u23e9-\u23ec\u23f0\u23f3\u267e\u26ce\u2705\u2728\u274c\u274e\u2753-\u2755\u2795-\u2797\u27b0\u27bf\ue50a])|\ufe0f/g;var Ve;function jt(){if(Ve)return ve;Ve=1;var t=ue&&ue.__createBinding||(Object.create?function(s,r,o,f){f===void 0&&(f=o);var m=Object.getOwnPropertyDescriptor(r,o);(!m||("get"in m?!r.__esModule:m.writable||m.configurable))&&(m={enumerable:!0,get:function(){return r[o]}}),Object.defineProperty(s,f,m)}:function(s,r,o,f){f===void 0&&(f=o),s[f]=r[o]}),n=ue&&ue.__setModuleDefault||(Object.create?function(s,r){Object.defineProperty(s,"default",{enumerable:!0,value:r})}:function(s,r){s.default=r}),d=ue&&ue.__importStar||function(s){if(s&&s.__esModule)return s;var r={};if(s!=null)for(var o in s)o!=="default"&&Object.prototype.hasOwnProperty.call(s,o)&&t(r,s,o);return n(r,s),r},i=ue&&ue.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(ve,"__esModule",{value:!0}),ve.language=void 0;const u=d(at()),e=d(it),a=X,y=i(He),g=e.regexp(/[\u0020\u3000\t]/),_=e.regexp(/[a-z0-9]/i),h=e.alt([e.crlf,e.cr,e.lf]);function C(s){return new e.Parser((r,o,f)=>{const m=[];let v=o;for(let S=0;S<s.length;S++){const O=s[S].handler(r,v,f);if(!O.success)return v===o?e.failure():e.success(v,r.slice(o,v));m.push(O.value),v=O.index}return e.success(v,m)})}const w=new e.Parser((s,r,o)=>o.linkLabel?e.failure():e.success(r,null)),p=new e.Parser((s,r,o)=>o.depth<o.nestLimit?e.success(r,null):e.failure());function l(s,r){const o=e.alt([e.seq([p,s],1),r??e.char]);return new e.Parser((f,m,v)=>{v.depth++;const S=o.handler(f,m,v);return v.depth--,S})}return ve.language=e.createLanguage({fullParser:s=>s.full.many(0),simpleParser:s=>s.simple.many(0),full:s=>e.alt([s.unicodeEmoji,s.centerTag,s.smallTag,s.plainTag,s.boldTag,s.italicTag,s.strikeTag,s.urlAlt,s.big,s.boldAsta,s.italicAsta,s.boldUnder,s.italicUnder,s.codeBlock,s.inlineCode,s.quote,s.mathBlock,s.mathInline,s.strikeWave,s.fn,s.mention,s.hashtag,s.emojiCode,s.link,s.url,s.search,s.text]),simple:s=>e.alt([s.unicodeEmoji,s.emojiCode,s.text]),inline:s=>e.alt([s.unicodeEmoji,s.smallTag,s.plainTag,s.boldTag,s.italicTag,s.strikeTag,s.urlAlt,s.big,s.boldAsta,s.italicAsta,s.boldUnder,s.italicUnder,s.inlineCode,s.mathInline,s.strikeWave,s.fn,s.mention,s.hashtag,s.emojiCode,s.link,s.url,s.text]),quote:s=>{const r=e.seq([e.str(">"),g.option(),e.seq([e.notMatch(h),e.char],1).many(0).text()],2).sep(h,1),o=e.seq([h.option(),h.option(),e.lineBegin,r,h.option(),h.option()],3);return new e.Parser((f,m,v)=>{let S;if(S=o.handler(f,m,v),!S.success)return S;const O=S.value,E=S.index;return O.length===1&&O[0].length===0?e.failure():(S=l(s.fullParser).many(0).handler(O.join(`
`),0,v),S.success?e.success(E,u.QUOTE((0,a.mergeText)(S.value))):S)})},codeBlock:s=>{const r=e.str("```");return e.seq([h.option(),e.lineBegin,r,e.seq([e.notMatch(h),e.char],1).many(0),h,e.seq([e.notMatch(e.seq([h,r,e.lineEnd])),e.char],1).many(1),h,r,e.lineEnd,h.option()]).map(o=>{const f=o[3].join("").trim(),m=o[5].join("");return u.CODE_BLOCK(m,f.length>0?f:null)})},mathBlock:s=>{const r=e.str("\\["),o=e.str("\\]");return e.seq([h.option(),e.lineBegin,r,h.option(),e.seq([e.notMatch(e.seq([h.option(),o])),e.char],1).many(1),h.option(),o,e.lineEnd,h.option()]).map(f=>{const m=f[4].join("");return u.MATH_BLOCK(m)})},centerTag:s=>{const r=e.str("<center>"),o=e.str("</center>");return e.seq([h.option(),e.lineBegin,r,h.option(),e.seq([e.notMatch(e.seq([h.option(),o])),l(s.inline)],1).many(1),h.option(),o,e.lineEnd,h.option()]).map(f=>u.CENTER((0,a.mergeText)(f[4])))},big:s=>{const r=e.str("***");return C([r,e.seq([e.notMatch(r),l(s.inline)],1).many(1),r]).map(o=>typeof o=="string"?o:u.FN("tada",{},(0,a.mergeText)(o[1])))},boldAsta:s=>{const r=e.str("**");return C([r,e.seq([e.notMatch(r),l(s.inline)],1).many(1),r]).map(o=>typeof o=="string"?o:u.BOLD((0,a.mergeText)(o[1])))},boldTag:s=>{const r=e.str("<b>"),o=e.str("</b>");return C([r,e.seq([e.notMatch(o),l(s.inline)],1).many(1),o]).map(f=>typeof f=="string"?f:u.BOLD((0,a.mergeText)(f[1])))},boldUnder:s=>{const r=e.str("__");return e.seq([r,e.alt([_,g]).many(1),r]).map(o=>u.BOLD((0,a.mergeText)(o[1])))},smallTag:s=>{const r=e.str("<small>"),o=e.str("</small>");return C([r,e.seq([e.notMatch(o),l(s.inline)],1).many(1),o]).map(f=>typeof f=="string"?f:u.SMALL((0,a.mergeText)(f[1])))},italicTag:s=>{const r=e.str("<i>"),o=e.str("</i>");return C([r,e.seq([e.notMatch(o),l(s.inline)],1).many(1),o]).map(f=>typeof f=="string"?f:u.ITALIC((0,a.mergeText)(f[1])))},italicAsta:s=>{const r=e.str("*"),o=e.seq([r,e.alt([_,g]).many(1),r]);return new e.Parser((f,m,v)=>{const S=o.handler(f,m,v);if(!S.success)return e.failure();const O=f.slice(0,m);return/[a-z0-9]$/i.test(O)?e.failure():e.success(S.index,u.ITALIC((0,a.mergeText)(S.value[1])))})},italicUnder:s=>{const r=e.str("_"),o=e.seq([r,e.alt([_,g]).many(1),r]);return new e.Parser((f,m,v)=>{const S=o.handler(f,m,v);if(!S.success)return e.failure();const O=f.slice(0,m);return/[a-z0-9]$/i.test(O)?e.failure():e.success(S.index,u.ITALIC((0,a.mergeText)(S.value[1])))})},strikeTag:s=>{const r=e.str("<s>"),o=e.str("</s>");return C([r,e.seq([e.notMatch(o),l(s.inline)],1).many(1),o]).map(f=>typeof f=="string"?f:u.STRIKE((0,a.mergeText)(f[1])))},strikeWave:s=>{const r=e.str("~~");return C([r,e.seq([e.notMatch(e.alt([r,h])),l(s.inline)],1).many(1),r]).map(o=>typeof o=="string"?o:u.STRIKE((0,a.mergeText)(o[1])))},unicodeEmoji:s=>{const r=RegExp(y.default.source);return e.regexp(r).map(o=>u.UNI_EMOJI(o))},plainTag:s=>{const r=e.str("<plain>"),o=e.str("</plain>");return e.seq([r,h.option(),e.seq([e.notMatch(e.seq([h.option(),o])),e.char],1).many(1).text(),h.option(),o],2).map(f=>u.PLAIN(f))},fn:s=>{const r=new e.Parser((v,S,O)=>{const E=e.regexp(/[a-z0-9_]+/i).handler(v,S,O);return E.success?e.success(E.index,E.value):E}),o=e.seq([e.regexp(/[a-z0-9_]+/i),e.seq([e.str("="),e.regexp(/[a-z0-9_.-]+/i)],1).option()]).map(v=>({k:v[0],v:v[1]!=null?v[1]:!0})),f=e.seq([e.str("."),o.sep(e.str(","),1)],1).map(v=>{const S={};for(const O of v)S[O.k]=O.v;return S}),m=e.str("]");return C([e.str("$["),r,f.option(),e.str(" "),e.seq([e.notMatch(m),l(s.inline)],1).many(1),m]).map(v=>{if(typeof v=="string")return v;const S=v[1],O=v[2]||{},E=v[4];return u.FN(S,O,(0,a.mergeText)(E))})},inlineCode:s=>{const r=e.str("`");return e.seq([r,e.seq([e.notMatch(e.alt([r,e.str("´"),h])),e.char],1).many(1),r]).map(o=>u.INLINE_CODE(o[1].join("")))},mathInline:s=>{const r=e.str("\\("),o=e.str("\\)");return e.seq([r,e.seq([e.notMatch(e.alt([o,h])),e.char],1).many(1),o]).map(f=>u.MATH_INLINE(f[1].join("")))},mention:s=>{const r=e.seq([w,e.str("@"),e.regexp(/[a-z0-9_-]+/i),e.seq([e.str("@"),e.regexp(/[a-z0-9_.-]+/i)],1).option()]);return new e.Parser((o,f,m)=>{let v;if(v=r.handler(o,f,m),!v.success)return e.failure();const S=o.slice(0,f);if(/[a-z0-9]$/i.test(S))return e.failure();let O=!1;const E=v.index,j=v.value[2],B=v.value[3];let U=B;B!=null&&(v=/[.-]+$/.exec(B),v!=null&&(U=B.slice(0,-1*v[0].length),U.length===0&&(O=!0,U=null)));let Y=j;if(v=/-+$/.exec(j),v!=null&&(U==null?Y=j.slice(0,-1*v[0].length):O=!0),(Y.length===0||Y[0]==="-")&&(O=!0),U!=null&&/^[.-]/.test(U)&&(O=!0),O)return e.success(E,o.slice(f,E));const Ee=U!=null?`@${Y}@${U}`:`@${Y}`;return e.success(f+Ee.length,u.MENTION(Y,U,Ee))})},hashtag:s=>{const r=e.str("#"),o=e.seq([e.notMatch(e.alt([e.regexp(/[ \u3000\t.,!?'"#:/[\]【】()「」（）<>]/),g,h])),e.char],1),f=e.lazy(()=>e.alt([e.seq([e.str("("),l(f,o).many(0),e.str(")")]),e.seq([e.str("["),l(f,o).many(0),e.str("]")]),e.seq([e.str("「"),l(f,o).many(0),e.str("」")]),e.seq([e.str("（"),l(f,o).many(0),e.str("）")]),o])),m=e.seq([w,r,f.many(1).text()],2);return new e.Parser((v,S,O)=>{const E=m.handler(v,S,O);if(!E.success)return e.failure();const j=v.slice(0,S);if(/[a-z0-9]$/i.test(j))return e.failure();const B=E.index,U=E.value;return/^[0-9]+$/.test(U)?e.failure():e.success(B,u.HASHTAG(U))})},emojiCode:s=>{const r=e.notMatch(e.regexp(/[a-z0-9]/i)),o=e.str(":");return e.seq([e.alt([e.lineBegin,r]),o,e.regexp(/[a-z0-9_+-]+/i),o,e.alt([e.lineEnd,r])],2).map(f=>u.EMOJI_CODE(f))},link:s=>{const r=new e.Parser((f,m,v)=>{v.linkLabel=!0;const S=s.inline.handler(f,m,v);return v.linkLabel=!1,S}),o=e.str("]");return e.seq([w,e.alt([e.str("?["),e.str("[")]),e.seq([e.notMatch(e.alt([o,h])),l(r)],1).many(1),o,e.str("("),e.alt([s.urlAlt,s.url]),e.str(")")]).map(f=>{const m=f[1]==="?[",v=f[2],S=f[5];return u.LINK(m,S.props.url,(0,a.mergeText)(v))})},url:s=>{const r=e.regexp(/[.,a-z0-9_/:%#@$&?!~=+-]/i),o=e.lazy(()=>e.alt([e.seq([e.str("("),l(o,r).many(0),e.str(")")]),e.seq([e.str("["),l(o,r).many(0),e.str("]")]),r])),f=e.seq([w,e.regexp(/https?:\/\//),o.many(1).text()]);return new e.Parser((m,v,S)=>{let O;if(O=f.handler(m,v,S),!O.success)return e.failure();const E=O.index;let j=E;const B=O.value[1];let U=O.value[2];return O=/[.,]+$/.exec(U),O!=null&&(j-=O[0].length,U=U.slice(0,-1*O[0].length),U.length===0)?e.success(E,m.slice(v,E)):e.success(j,u.N_URL(B+U,!1))})},urlAlt:s=>{const r=e.str("<"),o=e.str(">"),f=e.seq([w,r,e.regexp(/https?:\/\//),e.seq([e.notMatch(e.alt([o,g])),e.char],1).many(1),o]).text();return new e.Parser((m,v,S)=>{const O=f.handler(m,v,S);if(!O.success)return e.failure();const E=O.value.slice(1,O.value.length-1);return e.success(O.index,u.N_URL(E,!0))})},search:s=>{const r=e.alt([e.regexp(/\[(検索|search)\]/i),e.regexp(/(検索|search)/i)]);return e.seq([h.option(),e.lineBegin,e.seq([e.notMatch(e.alt([h,e.seq([g,r,e.lineEnd])])),e.char],1).many(1),g,r,e.lineEnd,h.option()]).map(o=>{const f=o[2].join("");return u.SEARCH(f,`${f}${o[3]}${o[4]}`)})},text:s=>e.char}),ve}var Ye;function kt(){if(Ye)return oe;Ye=1,Object.defineProperty(oe,"__esModule",{value:!0}),oe.simpleParser=oe.fullParser=void 0;const t=jt(),n=X;function d(u,e){const a=t.language.fullParser.handler(u,0,{nestLimit:e.nestLimit!=null?e.nestLimit:20,depth:0,linkLabel:!1,trace:!1});return(0,n.mergeText)(a.value)}oe.fullParser=d;function i(u){const e=t.language.simpleParser.handler(u,0,{});return(0,n.mergeText)(e.value)}return oe.simpleParser=i,oe}var Ze;function At(){if(Ze)return G;Ze=1,Object.defineProperty(G,"__esModule",{value:!0}),G.extract=G.inspect=G.toString=G.parseSimple=G.parse=void 0;const t=kt(),n=X;function d(y,g={}){return(0,t.fullParser)(y,{nestLimit:g.nestLimit})}G.parse=d;function i(y){return(0,t.simpleParser)(y)}G.parseSimple=i;function u(y){return Array.isArray(y)?(0,n.stringifyTree)(y):(0,n.stringifyNode)(y)}G.toString=u;function e(y,g){if(Array.isArray(y))for(const _ of y)(0,n.inspectOne)(_,g);else(0,n.inspectOne)(y,g)}G.inspect=e;function a(y,g){const _=[];return e(y,h=>{g(h)&&_.push(h)}),_}return G.extract=a,G}var et;function at(){return et||(et=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.TEXT=t.PLAIN=t.FN=t.LINK=t.N_URL=t.HASHTAG=t.MENTION=t.MATH_INLINE=t.INLINE_CODE=t.STRIKE=t.ITALIC=t.SMALL=t.BOLD=t.EMOJI_CODE=t.UNI_EMOJI=t.CENTER=t.MATH_BLOCK=t.CODE_BLOCK=t.SEARCH=t.QUOTE=t.extract=t.inspect=t.toString=t.parseSimple=t.parse=void 0;var n=At();Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return n.parse}}),Object.defineProperty(t,"parseSimple",{enumerable:!0,get:function(){return n.parseSimple}}),Object.defineProperty(t,"toString",{enumerable:!0,get:function(){return n.toString}}),Object.defineProperty(t,"inspect",{enumerable:!0,get:function(){return n.inspect}}),Object.defineProperty(t,"extract",{enumerable:!0,get:function(){return n.extract}});var d=De;Object.defineProperty(t,"QUOTE",{enumerable:!0,get:function(){return d.QUOTE}}),Object.defineProperty(t,"SEARCH",{enumerable:!0,get:function(){return d.SEARCH}}),Object.defineProperty(t,"CODE_BLOCK",{enumerable:!0,get:function(){return d.CODE_BLOCK}}),Object.defineProperty(t,"MATH_BLOCK",{enumerable:!0,get:function(){return d.MATH_BLOCK}}),Object.defineProperty(t,"CENTER",{enumerable:!0,get:function(){return d.CENTER}}),Object.defineProperty(t,"UNI_EMOJI",{enumerable:!0,get:function(){return d.UNI_EMOJI}}),Object.defineProperty(t,"EMOJI_CODE",{enumerable:!0,get:function(){return d.EMOJI_CODE}}),Object.defineProperty(t,"BOLD",{enumerable:!0,get:function(){return d.BOLD}}),Object.defineProperty(t,"SMALL",{enumerable:!0,get:function(){return d.SMALL}}),Object.defineProperty(t,"ITALIC",{enumerable:!0,get:function(){return d.ITALIC}}),Object.defineProperty(t,"STRIKE",{enumerable:!0,get:function(){return d.STRIKE}}),Object.defineProperty(t,"INLINE_CODE",{enumerable:!0,get:function(){return d.INLINE_CODE}}),Object.defineProperty(t,"MATH_INLINE",{enumerable:!0,get:function(){return d.MATH_INLINE}}),Object.defineProperty(t,"MENTION",{enumerable:!0,get:function(){return d.MENTION}}),Object.defineProperty(t,"HASHTAG",{enumerable:!0,get:function(){return d.HASHTAG}}),Object.defineProperty(t,"N_URL",{enumerable:!0,get:function(){return d.N_URL}}),Object.defineProperty(t,"LINK",{enumerable:!0,get:function(){return d.LINK}}),Object.defineProperty(t,"FN",{enumerable:!0,get:function(){return d.FN}}),Object.defineProperty(t,"PLAIN",{enumerable:!0,get:function(){return d.PLAIN}}),Object.defineProperty(t,"TEXT",{enumerable:!0,get:function(){return d.TEXT}})}(ke)),ke}var qt=at(),Rt=function(t){var n=25,d=["useTransform","center"];if(!t)throw new Error("No config object has been provided.");for(var i of d)typeof t[i]!="boolean"&&(t[i]=!0);typeof t.gutter!="number"&&(t.gutter=n),t.container||tt("container"),!t.items&&!t.static&&tt("items or static")},tt=function(t){throw new Error("Missing property '"+t+"' in MagicGrid config")},Bt=function(t){var n=t[0];for(var d of t)d.height<n.height&&(n=d);return n},V=function(n){Rt(n),n.container instanceof HTMLElement?this.container=n.container:this.container=document.querySelector(n.container),this.static=n.static||!1,this.size=n.items,this.gutter=n.gutter,this.maxColumns=n.maxColumns||!1,this.useMin=n.useMin||!1,this.useTransform=n.useTransform,this.animate=n.animate||!1,this.center=n.center,this.styledItems=new Set};V.prototype.initStyles=function(){if(this.ready()){this.container.style.position="relative";for(var n=this.items(),d=0;d<n.length;d++)if(!this.styledItems.has(n[d])){var i=n[d].style;i.position="absolute",this.animate&&(i.transition=(this.useTransform?"transform":"top, left")+" 0.2s ease"),this.styledItems.add(n[d])}}};V.prototype.items=function(){return Array.from(this.container.children).filter(function(n){return getComputedStyle(n).display!=="none"})};V.prototype.colWidth=function(){return this.items()[0].getBoundingClientRect().width+this.gutter};V.prototype.setup=function(){var n=this.container.getBoundingClientRect().width,d=this.colWidth(),i=Math.floor(n/d)||1,u=[];this.maxColumns&&i>this.maxColumns&&(i=this.maxColumns);for(var e=0;e<i;e++)u[e]={height:0,index:e};var a=n-i*d+this.gutter;return{cols:u,wSpace:a}};V.prototype.nextCol=function(n,d){return this.useMin?Bt(n):n[d%n.length]};V.prototype.positionItems=function(){var n=this.setup(),d=n.cols,i=n.wSpace,u=0,e=this.colWidth(),a=this.items();i=this.center?Math.floor(i/2):0,this.initStyles();for(var y=0;y<a.length;y++){var g=this.nextCol(d,y),_=a[y],h=g.height?this.gutter:0,C=g.index*e+i+"px",w=g.height+h+"px";this.useTransform?_.style.transform="translate("+C+", "+w+")":(_.style.top=w,_.style.left=C),g.height+=_.getBoundingClientRect().height+h,g.height>u&&(u=g.height)}this.container.style.height=u+this.gutter+"px"};V.prototype.ready=function(){return this.static?!0:this.items().length>=this.size};V.prototype.getReady=function(){var n=this,d=setInterval(function(){n.ready()&&(clearInterval(d),n.listen())},100)};V.prototype.listen=function(){var n=this;if(this.ready()){var d;window.addEventListener("resize",function(){d||(d=setTimeout(function(){n.positionItems(),d=null},200))}),this.positionItems()}else this.getReady()};const _e=t=>{t.scrollTo({top:t.scrollHeight})},Ae=t=>typeof t!="string"?t:t.replace(/[&'`"<>]/g,n=>({"&":"&amp;","'":"&#x27;","`":"&#x60;",'"':"&quot;","<":"&lt;",">":"&gt;"})[n]),Dt=t=>{const n=new Date().getTime()-t.getTime(),d=new Date(n);return d.getUTCFullYear()-1970?d.getUTCFullYear()-1970+"年前":d.getUTCMonth()?d.getUTCMonth()+"ヶ月前":d.getUTCDate()-1?d.getUTCDate()-1+"日前":d.getUTCHours()?d.getUTCHours()+"時間前":d.getUTCMinutes()?d.getUTCMinutes()+"分前":d.getUTCSeconds()+"秒前"},Ht=()=>{const t=navigator.userAgent,n=_=>_.test(t),i=n(/Android/)?"Android":n(/Linux/)?"Linux":n(/Mac OS X/)&&!n(/iPhone OS|CPU OS/)?"macOS":n(/Windows/)?"Windows":n(/iPhone|iPod/)?"iOS":n(/iPad/)?"iPadOS":n(/CrOS/)?"ChromeOS":"Unknown OS",u=(_,h)=>new RegExp(`(${_})(.*?)(${h})`).exec(t)[2],a=(()=>{switch(i){case"Android":return u("Android ","[.;]");case"macOS":return u("Mac OS X ","[;)]").replace("_",".");case"Windows":const _=Number(u("Windows NT ","[;)]"));switch(_){case 10:return"10(11)";case 6.3:return"8.1";case 6.2:return"8";case 6.1:return"7";case 6:return"Vista";default:return _>10?"新規のバージョン":_<6?"以前のバージョン":"未知のバージョン"}case"iOS":case"iPadOS":return u("iPhone;? i?OS |CPU OS ",";? ").replace("_",".");case"ChromeOS":return u("CrOS "," ");default:return""}})();return`${n(/Edge|Edg/)?"Edge":n(/Firefox|FxiOS/)?"Firefox":n(/Chrome|CriOS/)?"Chrome":n(/iPhone|iPad|iPod|Mac/)&&n(/Safari/)?"Safari":n(/iPad/)?"iPadOS":"Unknown Browser"} on ${i} ${a}`},Ut=t=>{const n=crypto.randomUUID(),d=new URL(`https://${t}/miauth/${n}`),i=d.searchParams,u=Ht();i.append("name",`マルチタイムライン via ${u}`);const e=new URL(`${location.origin}/callback`);e.searchParams.append("host",t),i.append("callback",e.toString()),i.append("permission","read:account"),location.href=d.toString()},xt=async()=>{const t=new URLSearchParams(location.search);history.replaceState(null,null,"/");const n=t.get("session"),d=t.get("host");if(!n||!d)return;await new Re({origin:`https://${d}`}).request(`miauth/${n}/check`,{}).then(u=>{if(u.ok){const e=localStorage.getItem("auths"),a=e&&JSON.parse(e)||[];a.push({host:d,token:u.token,user:u.user}),localStorage.setItem("auths",JSON.stringify(a))}}).catch(u=>{console.log(`${d}'s miauth/{session}/check could not load`),console.dir(u)})},Ft=async()=>{switch(location.pathname){case"/":break;case"/callback":await xt();break;default:alert("指定のURLにはページがありません。"),history.replaceState(null,null,"/")}};document.addEventListener("DOMContentLoaded",async()=>{await Ft();const t=document.querySelector(".grid"),n=document.querySelectorAll(".container"),d=[...n].filter(I=>["media","rn-media"].some(P=>I.classList.contains(P))),i=document.getElementById("notes-list"),u=document.getElementById("renotes-list"),e=document.getElementById("media-list"),a=document.getElementById("rn-media-list"),y=document.getElementById("note-latest"),g=document.getElementById("renote-latest"),_=document.getElementById("medium-latest"),h=document.getElementById("rn-medium-latest"),C=document.querySelector(".resize-handle"),w=document.getElementById("menu-btn"),p=document.querySelector(".config"),l=document.getElementById("select-display"),s=document.getElementById("select-display-value"),r=document.getElementById("select-timeline"),f=document.querySelector(".misskey-link").querySelector("a"),m=document.querySelectorAll(".host"),v=document.forms["custom-host"],S=document.getElementById("custom-host"),O=document.getElementById("reset-host"),E=document.getElementById("keep-emojis"),j=document.querySelector('[for="authenticate"]'),B=document.getElementById("authenticate"),U=document.getElementById("clear-emojis-cache"),Y="https://misskey.io",Ee=m[0].textContent,ft=document.title,le=new V({container:e,items:1,gutter:20,animate:!0}),he=new V({container:a,items:1,gutter:20,animate:!0});le.listen(),he.listen();let K,D;const ae=I=>I.replace("https://",""),Le=()=>{localStorage.getItem("tlOrigin")?(K=localStorage.getItem("tlOrigin"),D=ae(K),document.title=`${D} マルチタイムライン(連携対応版)`,m.forEach(I=>{I.textContent=D}),S.value=D,p.classList.add("customized-host")):(K=Y,D=ae(K),document.title=ft,m.forEach(I=>{I.textContent=Ee}),S.value="",p.classList.remove("customized-host")),f.href=K,E.checked=!!localStorage.getItem(`tlEmojis${D}`)};Le();const Ce=I=>{const P=localStorage.getItem("auths");return(P&&JSON.parse(P)||[]).find(k=>k.host===I)||null};let re;const Te=I=>{I?(r.querySelectorAll(":disabled").forEach(R=>R.disabled=!1),re=0,j.textContent=`@${I.user.username}に接続`,B.textContent="切断"):(r.querySelectorAll('[value="0"], [value="2"]').forEach(R=>R.disabled=!0),re=1,j.textContent="認証してHTLとSTLも見る",B.textContent="認証"),r.value=re},W={},Ue=async I=>{const P=ae(I),R=Date.now()-Number(localStorage.getItem(`tlEmojis${P}Loaded`))>=24*60*60*1e3;if(localStorage.getItem(`tlEmojis${P}`)&&localStorage.getItem(`tlEmojis${P}Loaded`)&&!R){W[P]=JSON.parse(localStorage.getItem(`tlEmojis${P}`)),console.log("Loaded emojis from cache");return}W[P]={},await fetch(`${I}/api/emojis`).then(async k=>{const M=await k.json();k.status===200?(M.emojis.forEach(q=>{W[P][q.name]=q.url}),localStorage.setItem(`tlEmojis${P}`,JSON.stringify(W[P])),localStorage.setItem(`tlEmojis${P}Loaded`,Date.now())):console.log("error or no content",k.status)}).catch(k=>{console.error("Failed to load Emojis",k)})};let J=Ce(D);Te(J);const z=async I=>{await Ue(I);const P=new It(I,J?{token:J.token}:null),R=["homeTimeline","localTimeline","hybridTimeline","globalTimeline"],k=P.useChannel(R[re]),M={note:!0,renote:!0,medium:!0,rnMedium:!0},N={notes:[],renotes:[],media:[],rnMedia:[]},q=150,ie=["all","hide-sensitive","sensitive-only"],Z=["全て","NSFW除外","NSFWのみ"],x=new AbortController;let Q=null;const $e=async(c,L)=>{W[L]=W[L]||{},await new Re({origin:`https://${L}`}).request("emoji",{name:c}).then(b=>{const $=b!==null&&(L===ae(I)||b.localOnly!==!0);W[L][c]=$?b.url:null}).catch(b=>{console.log(`${L}'s Emoji`,`:${c}:`,"not found"),console.dir(b),W[L][c]=null})},de=c=>{const L=c.user.host;W[L]=W[L]||{},[c.user.emojis,c.emojis].forEach(T=>{Object.keys(T).forEach(b=>{const $=T[b];W[L][b]=$})})},pe=async(c,L)=>(L=L||ae(I),(!(L in W)||!(c in W[L]))&&await $e(c,L),W[L][c]||null),te=async(c,L)=>{if(!c)return"";const T=qt.parseSimple(c);let b="";for(const $ of T)switch($.type){case"emojiCode":const H=await pe($.props.name,L);H===null?b+=`:${$.props.name}:`:b+=`<img class="custom-emoji" src="${H}" alt=":${$.props.name}:" title=":${$.props.name}:">`;break;case"text":b+=$.props.text.replaceAll(/\n/g,"<br>");break;case"unicodeEmoji":b+=$.props.emoji;break}return b},Ne=async(c,L)=>c.cw!==null?`[CW]${await te(Ae(c.cw),L)} <span class="cwtext">${await te(Ae(c.text),L)}</span>`:c.text?await te(Ae(c.text),L):c.renoteId||c.fileIds.length?"":'<span class="nothing">なにもありません</span>',Me=c=>c.files.some(L=>L.isSensitive),xe=async(c,L)=>{c.isRenote=!!c.renoteId,c.host=c.user.host;const T=c.isRenote?c.renote:null;T&&(T.host=T.user.host);const b={name:c.user.name?await te(c.user.name,c.host):c.user.username,plainName:c.user.name?c.user.name:c.user.username,text:await Ne(c,c.host),fileCount:c.fileIds.length?`<span class="file-count">[${c.fileIds.length}つのファイル]</span>`:"",time:new Date(c.createdAt).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",second:"2-digit"}),containsSensitive:Me(c)||T&&Me(T)?"contains-sensitive":"",...L==="renote"&&{rnName:T.user.name?await te(T.user.name,T.host):T.user.username,plainRnName:T.user.name?T.user.name:T.user.username,rnText:await Ne(T,T.host),rnFileCount:T.fileIds.length?`<span class="file-count">[${T.fileIds.length}つのファイル]</span>`:"",rnTime:Dt(new Date(T.createdAt))}};return L==="note"?`<li data-id="${c.id}" class="${b.containsSensitive}">
        <span class="wrap"><span class="name" title="${b.plainName}">${b.name}</span><span class="text">${b.text}${b.fileCount}</span></span><a href="${I}/notes/${c.id}" class="time" target="misskey" rel=”noopener”>${b.time}</a>
      </li>
      `:L==="renote"?`<li data-id="${c.id}" class="${b.containsSensitive}">
        <div class="renote-info">
          <span class="wrap"><span class="name" title="${b.plainName}">${b.name}</span><span class="text">${b.text}${b.fileCount}</span></span><a href="${I}/notes/${c.id}" class="time" target="misskey" rel=”noopener”>${b.time}</a>
        </div>
        <div class="renoted-note">
          <span class="wrap"><span class="name" title="${b.plainRnName}">${b.rnName}</span><span class="text">${b.rnText}${b.rnFileCount}</span></span><a href="${I}/notes/${T.id}" class="time" target="misskey" rel=”noopener”>${b.rnTime}</a>
        </div>
      </li>
      `:!1},Fe=async(c,L)=>{c.isRenote=!!c.renoteId,c.host=c.user.host;const T=c.isRenote?c.renote:null;T&&(T.host=T.user.host);const b=L==="note"&&c||L==="renote"&&T,$=b.files[0],H={text:await Ne(b,b.host),fileCount:(je=>je.fileIds.length>1?`<span class="more-file-count">+ ${je.fileIds.length-1}</span>`:"")(b),containsSensitive:Me(b)||b.cw!==null?"contains-sensitive":""};return $.type.includes("image")||$.type.includes("video")?`<li data-id="${c.id}" ${T?`data-rn-id="${T.id}"`:""} class="${H.containsSensitive}">
        <a href="${I}/notes/${c.id}" class="link" target="misskey" rel=”noopener”>
          <img src="${$.thumbnailUrl||""}" alt="${$.comment||$.name}" class="${$.isSensitive||b.cw!==null?"is-sensitive":""}" ${$.type.includes("image")?`width="${$.properties.width}" height="${$.properties.height}"`:""}>
          ${$.type.includes("video")?'<span class="is-video">動画</span>':""}
          ${H.fileCount}
        </a>${H.text&&`
        <div class="text">
          ${H.text}
        </div>`}
      </li>
      `:$.type.includes("audio")?`<li data-id="${c.id}" ${T?`data-rn-id="${T.id}"`:""} class="${H.containsSensitive}">
        <a href="${I}/notes/${c.id}" class="link" target="misskey" rel=”noopener”>
          <span class="file-type">音声</span>
          ${H.fileCount}
        </a>${H.text&&`
        <div class="text">
          ${H.text}
        </div>`}
      </li>
      `:`<li data-id="${c.id}" ${T?`data-rn-id="${T.id}"`:""} class="${H.containsSensitive}">
        <a href="${I}/notes/${c.id}" class="link" target="misskey" rel=”noopener”>
          <span class="file-type">その他:${$.type}</span>
          ${H.fileCount}
        </a>${H.text&&`
        <div class="text">
          ${H.text}
        </div>`}
      </li>
      `},We=()=>{document.querySelectorAll("li .wrap").forEach(T=>{const b=T.querySelector(".text");T.classList.contains("is-open")||T.offsetWidth<T.scrollWidth||b.querySelector("br")?b.classList.add("is-long"):b.classList.remove("is-long")}),document.querySelectorAll("li > div.text").forEach(T=>{T.classList.contains("is-open")||T.offsetWidth<T.scrollWidth||T.querySelector("br")?T.classList.add("is-long"):T.classList.remove("is-long")})};window.addEventListener("resize",We,{signal:x.signal});let ge=!1;document.addEventListener("selectstart",()=>{document.addEventListener("pointerup",()=>{ge=!window.getSelection().isCollapsed},{once:!0,signal:x.signal})},{signal:x.signal});const ne={note:!1,renote:!1,medium:!1,rnMedium:!1},ze=c=>{if(ge){ge=!1;return}(c.target.closest(".is-long")||c.target.closest(".wrap")&&c.target.querySelector(".is-long"))&&(c.target.closest(".wrap").classList.toggle("is-open"),c.target.closest(".wrap").classList.contains("is-open")?c.currentTarget===i?(ne.note=M.note,M.note=!1,y.classList.add("show")):c.currentTarget===u&&(ne.renote=M.renote,M.renote=!1,g.classList.add("show")):c.currentTarget===i?ne.note&&y.click():c.currentTarget===u&&ne.renote&&g.click())};i.addEventListener("click",ze,{signal:x.signal}),u.addEventListener("click",ze,{signal:x.signal});const Ge=c=>{if(ge){ge=!1;return}c.target.closest(".is-long")&&(c.target.closest(".is-long").classList.toggle("is-open"),c.currentTarget===e?le.positionItems():c.currentTarget===a&&he.positionItems(),c.target.closest(".is-long").classList.contains("is-open")?c.currentTarget===e?(ne.medium=M.medium,M.medium=!1,_.classList.add("show")):c.currentTarget===a&&(ne.rnMedium=M.rnMedium,M.rnMedium=!1,h.classList.add("show")):c.currentTarget===e?ne.medium&&_.click():c.currentTarget===a&&ne.rnMedium&&h.click())};e.addEventListener("click",Ge,{signal:x.signal}),a.addEventListener("click",Ge,{signal:x.signal}),Node.prototype.appendToTl=async function(c){if(this!==i&&this!==u&&this!==e&&this!==a)return!1;const L=!Array.isArray(c);let T="";if(this===i||this===u){const b=this===i&&"note"||this===u&&"renote";if(L)T=await xe(c,b);else{const $=c;for(;$.length;)T+=await xe($.shift(),b)}for(this.insertAdjacentHTML("beforeend",T),M[this===i&&"note"||this===u&&"renote"]&&_e(this.parentElement);this.querySelectorAll("li").length>q;)this.firstElementChild.remove()}else if(this===e||this===a){const b=this===e&&"note"||this===a&&"renote",$=!L&&c.length||1;if(L){const F=c;if(b=="renote"){const ye=a.querySelector(`[data-rn-id="${F.renoteId}"]`);ye&&ye.remove()}T=await Fe(F,b)}else{const F=c;for(;F.length;){const ye=F.pop();if(b=="renote"){const Xe=a.querySelector(`[data-rn-id="${ye.renoteId}"]`);Xe&&Xe.remove()}T+=await Fe(ye,b)}}for(this.insertAdjacentHTML("afterbegin",T),M[this===e&&"medium"||this===a&&"rnMedium"]&&this.parentElement.scrollTo({top:0});this.querySelectorAll("li").length>q;)this.lastElementChild.remove();const H=[...this.children].slice(0,$);H.some(F=>getComputedStyle(F).display!=="none")&&(this===e?le.positionItems():this===a&&he.positionItems()),H.map(F=>F.querySelector("img")).filter(F=>F&&F.style.width===""&&F.src!=="").forEach(F=>{F.addEventListener("load",()=>{this===e?le.positionItems():this===a&&he.positionItems()},{once:!0})})}We()},P.on("_connected_",async()=>{console.log("connected"),document.visibilityState==="visible"&&(Q=await navigator.wakeLock.request("screen"))}),P.on("_disconnected_",()=>{console.log("disconnected"),Q!==null&&Q.release().then(()=>{Q=null})}),document.addEventListener("visibilitychange",async()=>{Q!==null&&document.visibilityState==="visible"&&P.state=="connected"&&(Q=await navigator.wakeLock.request("screen"))},{signal:x.signal});const Ke=async c=>{const L=!!c.renoteId,T=!!(c.text!==null||c.fileIds.length||!L);if(c.user.host&&de(c),T&&(M.note?await i.appendToTl(c):(N.notes.push(c),N.notes.length>q&&(N.notes=N.notes.slice(-q)))),L){const $=c.renote;$.user.host&&de($),M.renote?await u.appendToTl(c):(N.renotes.push(c),N.renotes.length>q&&(N.renotes=N.renotes.slice(-q)))}if(c.fileIds.length&&(M.medium?await e.appendToTl(c):(N.media.push(c),N.media.length>q&&(N.media=N.media.slice(-q)))),L&&c.renote.fileIds.length)if(M.rnMedium)await a.appendToTl(c);else{const $=N.rnMedia.findIndex(H=>H.renoteId===c.renoteId);$!==-1&&N.rnMedia.splice($,1),N.rnMedia.push(c),N.rnMedia.length>q&&(N.rnMedia=N.rnMedia.slice(-q))}},Je=["timeline","local-timeline","hybrid-timeline","global-timeline"];await new Re({origin:I,...J&&{credential:J.token}}).request(`notes/${Je[re]}`,{limit:15}).then(async c=>{c=c.reverse();let L=Promise.resolve();c.forEach(T=>L=L.then(()=>Ke(T))),await L}).catch(c=>{console.log(`${D}'s`,`notes/${Je[re]}`,"could not load"),console.dir(c)}),k.on("note",Ke);const we=async c=>{const L=c.target;L.textContent="読み込み中...",L===y?(M.note=!0,await i.appendToTl(N.notes)):L===g?(M.renote=!0,await u.appendToTl(N.renotes)):L===_?(M.medium=!0,await e.appendToTl(N.media)):L===h&&(M.rnMedium=!0,await a.appendToTl(N.rnMedia)),L.classList.remove("show"),L.textContent="新しいノートを見る"};y.addEventListener("click",we,{signal:x.signal}),g.addEventListener("click",we,{signal:x.signal}),_.addEventListener("click",we,{signal:x.signal}),h.addEventListener("click",we,{signal:x.signal}),n.forEach(c=>{c.addEventListener("scroll",async L=>{const T=c.querySelector('button[id$="-latest"]'),b=c.classList.contains("notes")?"notes":c.classList.contains("renotes")?"renotes":c.classList.contains("media")?"media":c.classList.contains("rn-media")?"rn-media":null;b==="notes"||b==="renotes"?c.scrollHeight-c.clientHeight-c.scrollTop>=3?(M[b.slice(0,-1)]=!1,T.classList.add("show")):N[b].length?b==="notes"?await i.appendToTl(N.notes):b==="renotes"&&await u.appendToTl(N.renotes):(M[b.slice(0,-1)]=!0,T.classList.remove("show")):(b==="media"||b==="rn-media")&&(c.scrollTop>1?(M[b==="media"&&"medium"||b==="rn-media"&&"rnMedium"]=!1,T.classList.add("show")):(N[b==="media"&&"media"||b==="rn-media"&&"rnMedia"].length&&(b==="media"?await e.appendToTl(N.media):b==="rn-media"&&await a.appendToTl(N.rnMedia)),M[b==="media"&&"medium"||b==="rn-media"&&"rnMedium"]=!0,T.classList.remove("show")))},{signal:x.signal})});const Qe=()=>{const c=document.querySelector(".confirm-sensitive"),L=document.getElementsByName("confirm-sensitive");let T;return c.classList.add("show"),L[0].focus(),[...L].forEach(b=>{b.addEventListener("click",$=>{$.target.value==="yes"?T(!0):$.target.value==="no"&&T(!1),c.classList.remove("show")},{signal:x.signal})}),new Promise(b=>{T=b})};let Pe=!1;if(localStorage.getItem("tlDisplay")){const c=localStorage.getItem("tlDisplay");if(c==="2"){const L=await Qe();l.value=L?c:c-1,L&&(Pe=!0)}else l.value=c;s.textContent=Z[l.value]}let be=l.value;t.classList.add(ie[be]),l.addEventListener("pointerdown",()=>{s.textContent=Z[be]},{once:!0,signal:x.signal}),l.addEventListener("input",async()=>{if(l.value==="2"&&!Pe)if(await Qe())Pe=!0;else{l.value=be;return}l.value!=="0"?localStorage.setItem("tlDisplay",l.value):localStorage.removeItem("tlDisplay"),t.classList.add(ie[l.value]),s.textContent=Z[l.value],t.classList.remove(ie[be]),be=l.value,M.note&&_e(i.parentElement),M.renote&&_e(u.parentElement),[...e.children].some(c=>getComputedStyle(c).display!=="none")&&le.positionItems(),[...a.children].some(c=>getComputedStyle(c).display!=="none")&&he.positionItems()},{signal:x.signal}),document.addEventListener("keydown",c=>{c.key==="Escape"&&(k.dispose(),Q!==null&&Q.release().then(()=>{Q=null}),alert("Escキーが押されたため、タイムラインの受信を停止しました。"))},{signal:x.signal}),z.notesScrollToBottom=()=>{M.note&&_e(i.parentElement),M.renote&&_e(u.parentElement)},z.dispose=()=>{k.dispose(),x.abort(),[i,u,e,a].forEach(c=>{c.textContent=""}),[e,a].forEach(c=>{c.removeAttribute("style")})}};await z(K);const Se=t.clientHeight,me=56;if(localStorage.getItem("tlGridHorizontalRatio")){const I=localStorage.getItem("tlGridHorizontalRatio"),R=(Se-me)/Se,k=I*R;t.style.gridTemplateRows=`${me}px ${k}% ${R*100-k}%`,d.forEach(M=>{M.style.paddingBottom=`${(R*100-k)*(Se/window.innerHeight)}dvh`})}const Ie=()=>{C.classList.remove("hover")};C.addEventListener("pointerenter",()=>{C.classList.add("hover")}),C.addEventListener("pointerleave",Ie),C.addEventListener("pointerdown",I=>{C.removeEventListener("pointerleave",Ie);const P=k=>{const M=t.clientHeight,N=Math.round(k.pageY),q=M-me,ie=q/M,Z=N-me;if(!k.isPrimary||Z<0||Z>q)return;const x=q/2,Q=Z-x,$e=Q<=15&&Q>=-15;let de;if($e){t.removeAttribute("style"),localStorage.removeItem("tlGridHorizontalRatio"),d.forEach(te=>{te.removeAttribute("style")}),z.notesScrollToBottom();return}else Z<=15?de=0:q-Z<=15?de=100:de=Z/q*100;const pe=de*ie;t.style.gridTemplateRows=`${me}px ${pe}% ${ie*100-pe}%`,localStorage.setItem("tlGridHorizontalRatio",de),d.forEach(te=>{te.style.paddingBottom=`${(ie*100-pe)*(M/window.innerHeight)}dvh`}),z.notesScrollToBottom()};document.addEventListener("pointermove",P);const R=k=>{k.isPrimary&&(C.classList.remove("hover"),document.removeEventListener("pointermove",P),document.removeEventListener("pointerup",R),C.addEventListener("pointerleave",Ie))};document.addEventListener("pointerup",R)}),C.addEventListener("dblclick",()=>{t.removeAttribute("style"),localStorage.removeItem("tlGridHorizontalRatio"),d.forEach(I=>{I.removeAttribute("style")}),z.notesScrollToBottom()});const fe=document.body,Oe=I=>{!I.target.closest(".config")&&!I.target.closest(".confirm-sensitive")&&(fe.classList.remove("show-config"),fe.removeEventListener("pointerdown",Oe))};w.addEventListener("pointerdown",I=>{I.stopPropagation()}),w.addEventListener("click",I=>{I.stopPropagation(),fe.classList.toggle("show-config"),fe.classList.contains("show-config")?fe.addEventListener("pointerdown",Oe):fe.removeEventListener("pointerdown",Oe)}),r.addEventListener("change",async()=>{z.dispose(),re=Number(r.value),await z(K)}),v.addEventListener("submit",async I=>{I.preventDefault(),z.dispose(),S.value=S.value.replace(/https:\/\/(.+)\//g,"$1"),S.value!==ae(Y)?(localStorage.setItem("tlOrigin",`https://${S.value}`),K!==Y&&(E.checked||(localStorage.removeItem(`tlEmojis${D}`),localStorage.removeItem(`tlEmojis${D}Loaded`)))):localStorage.removeItem("tlOrigin"),Le(),J=Ce(D),Te(J),E.checked=!!localStorage.getItem(`tlEmojis${D}`),await z(K)}),O.addEventListener("click",async()=>{z.dispose(),localStorage.removeItem("tlOrigin"),E.checked||(localStorage.removeItem(`tlEmojis${D}`),localStorage.removeItem(`tlEmojis${D}Loaded`)),Le(),J=Ce(D),Te(J),E.checked=!!localStorage.getItem(`tlEmojis${D}`),await z(K)}),B.addEventListener("click",async()=>{if(J){const I=localStorage.getItem("auths"),P=I&&JSON.parse(I)||[],R=P.findIndex(k=>k.host===D);P.splice(R,1),localStorage.setItem("auths",JSON.stringify(P)),z.dispose(),J=null,Te(J),await z(K)}else Ut(D)}),U.addEventListener("click",async()=>{const I=localStorage.getItem(`tlEmojis${D}`);localStorage.removeItem(`tlEmojis${D}`),await Ue(K);const P=localStorage.getItem(`tlEmojis${D}`);if(I===P)alert("絵文字URLを再取得しましたが、変更はありませんでした。");else{const R={oldEmojis:JSON.parse(I),newEmojis:JSON.parse(P)},k=Object.keys(R.oldEmojis),M=Object.keys(R.newEmojis),N={old:k.filter(q=>!(q in R.newEmojis)),new:M.filter(q=>!(q in R.oldEmojis))};alert(`絵文字URLを再取得した結果、変更がありました。
消去された絵文字(${N.old.length}件):
${N.old.length?`:${N.old.join(`:
:`)}:`:"なし"}
登録された絵文字(${N.new.length}件):
${N.new.length?`:${N.new.join(`:
:`)}:`:"なし"}`)}})});
